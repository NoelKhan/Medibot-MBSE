// Environment configuration for different deployment stages
// Usage: import config from './env.config';

type Environment = 'development' | 'staging' | 'production';

interface EnvironmentConfig {
  apiUrl: string;
  apiTimeout: number;
  enableAnalytics: boolean;
  enableLogging: boolean;
  logLevel: 'debug' | 'info' | 'warn' | 'error';
  enableCrashReporting: boolean;
  sentryDsn?: string;
  amplitudeApiKey?: string;
  enableFallbackMode: boolean;
  enableMockData: boolean;
  enableDevPanel: boolean;
  showDetailedErrors: boolean;
}

// Get environment from Expo public env vars or default to development
const getEnvironment = (): Environment => {
  const env = process.env.EXPO_PUBLIC_ENVIRONMENT || 
              process.env.NODE_ENV || 
              'development';
  
  if (env === 'production') return 'production';
  if (env === 'staging' || env === 'preview') return 'staging';
  return 'development';
};

// Helper to parse boolean env vars
const parseBool = (value: string | undefined, defaultValue: boolean): boolean => {
  if (value === undefined) return defaultValue;
  return value.toLowerCase() === 'true';
};

const configs: Record<Environment, EnvironmentConfig> = {
  development: {
    apiUrl: process.env.EXPO_PUBLIC_BACKEND_URL || 'http://localhost:3000',
    apiTimeout: parseInt(process.env.EXPO_PUBLIC_API_TIMEOUT || '10000'),
    enableAnalytics: parseBool(process.env.EXPO_PUBLIC_ENABLE_ANALYTICS, false),
    enableLogging: parseBool(process.env.EXPO_PUBLIC_LOG_API_CALLS, true),
    logLevel: 'debug',
    enableCrashReporting: false,
    enableFallbackMode: parseBool(process.env.EXPO_PUBLIC_ENABLE_FALLBACK_MODE, true),
    enableMockData: parseBool(process.env.EXPO_PUBLIC_ENABLE_MOCK_DATA, true),
    enableDevPanel: parseBool(process.env.EXPO_PUBLIC_ENABLE_DEV_PANEL, true),
    showDetailedErrors: parseBool(process.env.EXPO_PUBLIC_SHOW_DETAILED_ERRORS, true),
  },
  
  staging: {
    apiUrl: process.env.EXPO_PUBLIC_BACKEND_URL || 'https://staging.api.medibot.com',
    apiTimeout: parseInt(process.env.EXPO_PUBLIC_API_TIMEOUT || '12000'),
    enableAnalytics: parseBool(process.env.EXPO_PUBLIC_ENABLE_ANALYTICS, true),
    enableLogging: parseBool(process.env.EXPO_PUBLIC_LOG_API_CALLS, true),
    logLevel: 'info',
    enableCrashReporting: true,
    sentryDsn: process.env.EXPO_PUBLIC_ERROR_REPORTING_URL,
    amplitudeApiKey: process.env.EXPO_PUBLIC_ANALYTICS_KEY,
    enableFallbackMode: parseBool(process.env.EXPO_PUBLIC_ENABLE_FALLBACK_MODE, true),
    enableMockData: parseBool(process.env.EXPO_PUBLIC_ENABLE_MOCK_DATA, false),
    enableDevPanel: parseBool(process.env.EXPO_PUBLIC_ENABLE_DEV_PANEL, true),
    showDetailedErrors: parseBool(process.env.EXPO_PUBLIC_SHOW_DETAILED_ERRORS, true),
  },
  
  production: {
    apiUrl: process.env.EXPO_PUBLIC_BACKEND_URL || 'https://api.medibot.com',
    apiTimeout: parseInt(process.env.EXPO_PUBLIC_API_TIMEOUT || '15000'),
    enableAnalytics: parseBool(process.env.EXPO_PUBLIC_ENABLE_ANALYTICS, true),
    enableLogging: parseBool(process.env.EXPO_PUBLIC_LOG_API_CALLS, false),
    logLevel: 'error',
    enableCrashReporting: true,
    sentryDsn: process.env.EXPO_PUBLIC_ERROR_REPORTING_URL,
    amplitudeApiKey: process.env.EXPO_PUBLIC_ANALYTICS_KEY,
    enableFallbackMode: parseBool(process.env.EXPO_PUBLIC_ENABLE_FALLBACK_MODE, false),
    enableMockData: parseBool(process.env.EXPO_PUBLIC_ENABLE_MOCK_DATA, false),
    enableDevPanel: parseBool(process.env.EXPO_PUBLIC_ENABLE_DEV_PANEL, false),
    showDetailedErrors: parseBool(process.env.EXPO_PUBLIC_SHOW_DETAILED_ERRORS, false),
  },
};

const environment = getEnvironment();
const config = configs[environment];

const fullConfig = {
  ...config,
  environment,
  isDevelopment: environment === 'development',
  isStaging: environment === 'staging',
  isProduction: environment === 'production',
};

export default fullConfig;

// Export for easy imports
export const {
  apiUrl,
  apiTimeout,
  enableAnalytics,
  enableLogging,
  logLevel,
  enableCrashReporting,
  isDevelopment,
  isStaging,
  isProduction,
  enableFallbackMode,
  enableMockData,
  enableDevPanel,
  showDetailedErrors,
} = fullConfig;
};

const environment = getEnvironment();
const config = configs[environment];

const fullConfig = {
  ...config,
  environment,
  isDevelopment: environment === 'development',
  isStaging: environment === 'staging',
  isProduction: environment === 'production',
};

export default fullConfig;

// Export for easy imports
export const {
  apiUrl,
  apiTimeout,
  enableAnalytics,
  enableLogging,
  logLevel,
  enableCrashReporting,
  isDevelopment,
  isStaging,
  isProduction,
} = fullConfig;
